<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„ä»¶æ¥å£è®¾è®¡å›¾ - UC9åˆ›å»ºè®¢å• & UC10è®¢å•æ”¯ä»˜</title>
    <script src="https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-box li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-box li:last-child {
            border-bottom: none;
        }
        
        .info-box li strong {
            color: #495057;
            display: inline-block;
            width: 150px;
        }
        
        .diagram-container {
            text-align: center;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .diagram-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: white;
            padding: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #667eea;
            font-size: 18px;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        
        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .feature-card p {
            color: #6c757d;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ æ„ä»¶æ¥å£è®¾è®¡å›¾</h1>
            <p>UC9åˆ›å»ºè®¢å• & UC10è®¢å•æ”¯ä»˜ - æ¥å£å…³ç³»å¯è§†åŒ–</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <h3>ğŸ“‹ æ¥å£è®¾è®¡è¯´æ˜</h3>
                <ul>
                    <li><strong>è®¾è®¡ç›®çš„ï¼š</strong>å±•ç¤ºè®¢å•æ„ä»¶ã€æ”¯ä»˜æ„ä»¶ã€åº“å­˜æ„ä»¶ä¹‹é—´çš„æ¥å£è°ƒç”¨å…³ç³»</li>
                    <li><strong>æ¥å£ç±»å‹ï¼š</strong>è¡¨ç¤ºå±‚æ¥å£ï¼ˆREST APIï¼‰ã€ä¸šåŠ¡é€»è¾‘å±‚æ¥å£ã€æ•°æ®è®¿é—®å±‚æ¥å£</li>
                    <li><strong>å¤–éƒ¨æ¥å£ï¼š</strong>ç¬¬ä¸‰æ–¹æ”¯ä»˜ç½‘å…³ã€è´­ç‰©è½¦æœåŠ¡ã€å•†å“æœåŠ¡ã€ç”¨æˆ·æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—</li>
                    <li><strong>è®¾è®¡åŸåˆ™ï¼š</strong>é«˜å†…èšã€ä½è€¦åˆã€æ¥å£éš”ç¦»ã€ä¾èµ–å€’ç½®</li>
                </ul>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <h4>ğŸ¯ è¡¨ç¤ºå±‚æ¥å£</h4>
                    <p>RESTful APIè®¾è®¡ï¼Œæä¾›HTTPæ¥å£ä¾›å‰ç«¯è°ƒç”¨ï¼ŒåŒ…æ‹¬å‚æ•°éªŒè¯ã€å¼‚å¸¸å¤„ç†ã€å“åº”å°è£…ç­‰åŠŸèƒ½ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h4>âš™ï¸ ä¸šåŠ¡é€»è¾‘å±‚æ¥å£</h4>
                    <p>å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬è®¢å•åˆ›å»ºã€æ”¯ä»˜å¤„ç†ã€åº“å­˜ç®¡ç†ã€äº‹åŠ¡æ§åˆ¶ã€å¼‚æ­¥æ¶ˆæ¯ç­‰ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h4>ğŸ’¾ æ•°æ®è®¿é—®å±‚æ¥å£</h4>
                    <p>å°è£…æ•°æ®åº“æ“ä½œï¼Œæä¾›CRUDæ¥å£ã€ä¹è§‚é”æ›´æ–°ã€åˆ†é¡µæŸ¥è¯¢ã€æ‰¹é‡æ“ä½œç­‰åŠŸèƒ½ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h4>ğŸ”— å¤–éƒ¨ç³»ç»Ÿæ¥å£</h4>
                    <p>ä¸ç¬¬ä¸‰æ–¹æ”¯ä»˜ç½‘å…³ã€å¾®æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆæ¥å£ï¼Œæ”¯æŒåŒæ­¥è°ƒç”¨å’Œå¼‚æ­¥å›è°ƒã€‚</p>
                </div>
            </div>
            
            <div class="diagram-container">
                <div class="loading">æ­£åœ¨åŠ è½½æ„ä»¶æ¥å£å›¾</div>
                <img id="diagram" style="display:none;" alt="æ„ä»¶æ¥å£è®¾è®¡å›¾">
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ’¡ æç¤ºï¼šå›¾ä¸­å±•ç¤ºäº†è®¢å•ã€æ”¯ä»˜ã€åº“å­˜ä¸‰ä¸ªæ„ä»¶çš„æ¥å£è®¾è®¡åŠå…¶ç›¸äº’è°ƒç”¨å…³ç³»</p>
            <p>ğŸ“„ è¯¦ç»†æ¥å£è§„èŒƒè¯·å‚è€ƒã€Š15.æ¥å£è®¾è®¡æ–‡æ¡£.mdã€‹</p>
        </div>
    </div>

    <script>
        // PlantUMLä»£ç 
        const plantUMLCode = `@startuml ComponentInterface_Diagram

!theme plain

' ============================
' ä¸­æ–‡å­—ä½“é…ç½®
' ============================
skinparam defaultFontName "Microsoft YaHei, SimHei, Arial Unicode MS"
skinparam defaultFontSize 11

skinparam componentStyle rectangle
skinparam linetype ortho

title æ„ä»¶æ¥å£è®¾è®¡å›¾ - UC9åˆ›å»ºè®¢å• & UC10è®¢å•æ”¯ä»˜

' ============================
' è®¢å•æ„ä»¶
' ============================
package "è®¢å•æ„ä»¶ (Order Component)" {
    
    ' è¡¨ç¤ºå±‚
    component "OrderController" as OC {
        portin "POST /orders" as OC_Create
        portin "GET /orders/{orderNumber}" as OC_Get
        portin "PUT /orders/{orderNumber}/cancel" as OC_Cancel
    }
    
    ' ä¸šåŠ¡é€»è¾‘å±‚
    component "OrderService" as OS {
        portin "createOrder()" as OS_Create
        portin "getOrderDetail()" as OS_Get
        portin "updateOrderStatus()" as OS_Update
        portin "cancelOrder()" as OS_Cancel
        portin "handlePaymentSuccess()" as OS_Handle
    }
    
    ' æ•°æ®è®¿é—®å±‚
    component "OrderRepository" as OR {
        portin "save()" as OR_Save
        portin "findByOrderNumber()" as OR_Find
        portin "update()" as OR_Update
        portin "findExpiredOrders()" as OR_Expired
    }
    
    OC --> OS : è°ƒç”¨
    OS --> OR : è°ƒç”¨
}

' ============================
' æ”¯ä»˜æ„ä»¶
' ============================
package "æ”¯ä»˜æ„ä»¶ (Payment Component)" {
    
    ' è¡¨ç¤ºå±‚
    component "PaymentController" as PC {
        portin "POST /payments" as PC_Create
        portin "POST /payments/callback/alipay" as PC_Alipay
        portin "POST /payments/callback/wechat" as PC_Wechat
        portin "GET /payments/{paymentNumber}/status" as PC_Status
    }
    
    ' ä¸šåŠ¡é€»è¾‘å±‚
    component "PaymentService" as PS {
        portin "createPaymentOrder()" as PS_Create
        portin "getPaymentStatus()" as PS_Status
        portin "handlePaymentCallback()" as PS_Callback
    }
    
    component "PaymentCallbackHandler" as PCH {
        portin "handlePaymentSuccess()" as PCH_Success
        portin "handlePaymentFailed()" as PCH_Failed
        portin "verifySignature()" as PCH_Verify
    }
    
    ' æ•°æ®è®¿é—®å±‚
    component "PaymentOrderRepository" as PR {
        portin "save()" as PR_Save
        portin "findByPaymentNumber()" as PR_Find
        portin "update()" as PR_Update
        portin "findExpiredPayments()" as PR_Expired
    }
    
    component "PaymentRecordRepository" as PRR {
        portin "save()" as PRR_Save
        portin "findByPaymentNumber()" as PRR_Find
    }
    
    PC --> PS : è°ƒç”¨
    PS --> PCH : è°ƒç”¨
    PS --> PR : è°ƒç”¨
    PCH --> PRR : è°ƒç”¨
}

' ============================
' åº“å­˜æ„ä»¶
' ============================
package "åº“å­˜æ„ä»¶ (Inventory Component)" {
    
    ' ä¸šåŠ¡é€»è¾‘å±‚
    component "InventoryService" as IS {
        portin "batchCheckStock()" as IS_Check
        portin "lockStock()" as IS_Lock
        portin "deductStock()" as IS_Deduct
        portin "releaseStock()" as IS_Release
    }
    
    ' æ•°æ®è®¿é—®å±‚
    component "InventoryRepository" as IR {
        portin "findByProductId()" as IR_Find
        portin "updateWithOptimisticLock()" as IR_Update
        portin "findByProductIds()" as IR_Batch
    }
    
    IS --> IR : è°ƒç”¨
}

' ============================
' å¤–éƒ¨ç³»ç»Ÿ
' ============================
cloud "å¤–éƒ¨ç³»ç»Ÿ" {
    component "æ”¯ä»˜å®ç½‘å…³" as Alipay {
        portin "processPayment()" as Alipay_Pay
        portout "paymentCallback()" as Alipay_Callback
    }
    
    component "å¾®ä¿¡æ”¯ä»˜ç½‘å…³" as Wechat {
        portin "processPayment()" as Wechat_Pay
        portout "paymentCallback()" as Wechat_Callback
    }
    
    component "è´­ç‰©è½¦æœåŠ¡" as Cart {
        portout "getCartItems()" as Cart_Get
        portin "clearPaidItems()" as Cart_Clear
    }
    
    component "å•†å“æœåŠ¡" as Product {
        portout "getProductDetails()" as Product_Get
    }
    
    component "ç”¨æˆ·æœåŠ¡" as User {
        portout "getUserAddresses()" as User_Get
    }
}

' ============================
' æ¶ˆæ¯é˜Ÿåˆ—
' ============================
queue "RabbitMQ" as MQ {
    portin "publish(payment.success)" as MQ_Pub
    portout "consume(payment.success.queue)" as MQ_Sub
}

' ============================
' æ•°æ®åº“
' ============================
database "MySQL" {
    component "order_db" as OrderDB {
        portin "ordersè¡¨" as OrderDB_Orders
        portin "order_itemsè¡¨" as OrderDB_Items
    }
    
    component "payment_db" as PaymentDB {
        portin "payment_ordersè¡¨" as PaymentDB_Orders
        portin "payment_recordsè¡¨" as PaymentDB_Records
    }
    
    component "product_db" as ProductDB {
        portin "inventoryè¡¨" as ProductDB_Inventory
    }
}

' ============================
' æ„ä»¶é—´æ¥å£è°ƒç”¨å…³ç³»
' ============================

' è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡
OS ..> IS : <<éœ€è¦>>\\nbatchCheckStock()\\nlockStock()

' è®¢å•æœåŠ¡è°ƒç”¨å¤–éƒ¨æœåŠ¡
OS ..> Cart_Get : <<éœ€è¦>>\\ngetCartItems()
OS ..> Product_Get : <<éœ€è¦>>\\ngetProductDetails()
OS ..> User_Get : <<éœ€è¦>>\\ngetUserAddresses()
OS ..> Cart_Clear : <<éœ€è¦>>\\nclearPaidItems()

' æ”¯ä»˜æœåŠ¡è°ƒç”¨è®¢å•æœåŠ¡
PS ..> OS_Get : <<éœ€è¦>>\\ngetOrderDetail()
PCH ..> OS_Update : <<éœ€è¦>>\\nupdateOrderStatus()
PCH ..> OS_Cancel : <<éœ€è¦>>\\ncancelOrder()

' æ”¯ä»˜æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡
PCH ..> IS_Deduct : <<éœ€è¦>>\\ndeductStock()
PCH ..> IS_Release : <<éœ€è¦>>\\nreleaseStock()

' æ”¯ä»˜æœåŠ¡è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜
PS ..> Alipay_Pay : <<éœ€è¦>>\\nprocessPayment()
PS ..> Wechat_Pay : <<éœ€è¦>>\\nprocessPayment()

' ç¬¬ä¸‰æ–¹æ”¯ä»˜å›è°ƒ
Alipay_Callback ..> PC_Alipay : <<å›è°ƒ>>
Wechat_Callback ..> PC_Wechat : <<å›è°ƒ>>

' æ¶ˆæ¯é˜Ÿåˆ—
PCH ..> MQ_Pub : <<å‘å¸ƒ>>\\npayment.success
MQ_Sub ..> OS_Handle : <<æ¶ˆè´¹>>

' æ•°æ®è®¿é—®å±‚è®¿é—®æ•°æ®åº“
OR --> OrderDB_Orders : SQL
OR --> OrderDB_Items : SQL
PR --> PaymentDB_Orders : SQL
PRR --> PaymentDB_Records : SQL
IR --> ProductDB_Inventory : SQL

' ============================
' å›¾ä¾‹
' ============================
legend right
    |= ç¬¦å· |= è¯´æ˜ |
    | â”€â”€> | åŒæ­¥è°ƒç”¨ |
    | ..> | å¼‚æ­¥è°ƒç”¨/éœ€æ±‚æ¥å£ |
    | <<éœ€è¦>> | éœ€æ±‚æ¥å£ |
    | <<å›è°ƒ>> | å›è°ƒæ¥å£ |
    | <<å‘å¸ƒ>> | æ¶ˆæ¯å‘å¸ƒ |
    | <<æ¶ˆè´¹>> | æ¶ˆæ¯æ¶ˆè´¹ |
endlegend

note right of OC
    **è¡¨ç¤ºå±‚æ¥å£**
    - RESTful API
    - å‚æ•°éªŒè¯
    - å¼‚å¸¸å¤„ç†
    - å“åº”å°è£…
end note

note right of OS
    **ä¸šåŠ¡é€»è¾‘å±‚æ¥å£**
    - ä¸šåŠ¡è§„åˆ™
    - äº‹åŠ¡ç®¡ç†
    - åˆ†å¸ƒå¼äº‹åŠ¡
    - å¼‚æ­¥æ¶ˆæ¯
end note

note right of OR
    **æ•°æ®è®¿é—®å±‚æ¥å£**
    - CRUDæ“ä½œ
    - ä¹è§‚é”
    - åˆ†é¡µæŸ¥è¯¢
    - æ‰¹é‡æ“ä½œ
end note

@enduml`;

        // ç¼–ç PlantUMLä»£ç 
        const encoded = plantumlEncoder.encode(plantUMLCode);
        
        // ç”Ÿæˆå›¾ç‰‡URL
        const imgUrl = 'https://www.plantuml.com/plantuml/svg/' + encoded;
        
        // åŠ è½½å›¾ç‰‡
        const img = document.getElementById('diagram');
        const loading = document.querySelector('.loading');
        
        img.onload = function() {
            loading.style.display = 'none';
            img.style.display = 'block';
        };
        
        img.onerror = function() {
            loading.innerHTML = 'âŒ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•';
            loading.style.color = '#dc3545';
        };
        
        img.src = imgUrl;
    </script>
</body>
</html>