@startuml UC9_CreateOrder_Activity

' ============================
' 中文字体配置（防止导出时中文乱码）
' ============================
skinparam defaultFontName "Microsoft YaHei, SimHei, Arial Unicode MS"
skinparam defaultFontSize 11

title UC9: 创建订单 - 活动图 (UML 2.5)

start

:用户进入购物车页面;
:系统显示商品列表;

while (需要调整商品?) is (是)
  :用户修改数量或删除商品;
  :系统重新计算总价;
endwhile (否)

:用户点击"去结算";
:系统显示订单确认页面;

if (收货地址存在?) then (是)
  :用户选择已有地址;
else (否)
  :用户新增收货地址;
  :填写收货信息;
  :系统保存地址;
endif

:系统显示订单清单和金额;
:用户确认订单信息;
:用户点击"提交订单";

:系统校验登录状态和地址;
:系统检查商品库存;

if (库存充足?) then (是)
  :系统预扣库存;
  
  if (预扣成功?) then (是)
    :生成订单号;
    :创建订单记录;
    :设置订单状态为"待支付";
    :设置30分钟超时;
    :跳转到支付页面;
    stop
  else (否)
    :回滚订单记录;
    :显示"订单创建失败";
    end
  endif
  
else (否)
  :显示"库存不足";
  end
endif

@enduml

